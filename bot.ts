import fetch from 'node-fetch';
import TelegramBot, { ChatId, MessageEntityType, SendMessageOptions } from 'node-telegram-bot-api';
import 'dotenv/config'
import http from 'http';
import express from 'express';

const SERVER_PORT = process.env.PORT || '3000';

const TOKEN = process.env.TELEGRAM_BOT_TOKEN;

const bot = new TelegramBot(TOKEN || '', { polling: true });

bot.onText(/\/start/, (msg: any) => { //todo rm any
    const chatId = msg.chat.id;

    const message = `â™»ï¸ EcoPlay | ÐšÐ¾Ð´Ñ‹ Ð¿ÐµÑ€ÐµÑ€Ð°Ð±Ð¾Ñ‚ÐºÐ¸

Ð”Ð¾Ð±Ñ€Ð¾ Ð¿Ð¾Ð¶Ð°Ð»Ð¾Ð²Ð°Ñ‚ÑŒ Ð² "EcoPlay" â€” Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ðµ, ÐºÐ¾Ñ‚Ð¾Ñ€Ð¾Ðµ Ð¿Ð¾Ð¼Ð¾Ð¶ÐµÑ‚ Ð²Ð°Ð¼ Ð½Ð°ÑƒÑ‡Ð¸Ñ‚ÑŒÑÑ Ð¿Ñ€Ð¸Ð½Ñ†Ð¸Ð¿Ð°Ð¼ Ñ€Ð°Ð·Ð´ÐµÐ»ÑŒÐ½Ð¾Ð³Ð¾ ÑÐ±Ð¾Ñ€Ð°!

Ð¡ Ð¿Ð¾Ð¼Ð¾Ñ‰ÑŒÑŽ Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ñ Ð²Ñ‹ ÑÐ¼Ð¾Ð¶ÐµÑ‚Ðµ Ð¿Ð¾Ð³Ñ€ÑƒÐ·Ð¸Ñ‚ÑŒÑÑ Ð² Ð¼Ð¸Ñ€ Ð¿ÐµÑ€ÐµÑ€Ð°Ð±Ð¾Ñ‚ÐºÐ¸. ÐŸÑ€Ð¾ÑÑ‚Ð¾ Ð½Ð°Ð¶Ð¼Ð¸Ñ‚Ðµ Ð½Ð° ÑÐ¸Ð¼Ð²Ð¾Ð» â™»ï¸ Ð¸ Ð½Ð°Ñ‡Ð¸Ð½Ð°Ð¹Ñ‚Ðµ Ð¿Ð¾Ð»ÑƒÑ‡Ð°Ñ‚ÑŒ ÑƒÐ½Ð¸ÐºÐ°Ð»ÑŒÐ½Ñ‹Ðµ ÐºÐ¾Ð´Ñ‹ Ð¿ÐµÑ€ÐµÑ€Ð°Ð±Ð¾Ñ‚ÐºÐ¸ Ñ€Ð°Ð·Ð»Ð¸Ñ‡Ð½Ñ‹Ñ… Ð¼Ð°Ñ‚ÐµÑ€Ð¸Ð°Ð»Ð¾Ð², Ñ‚Ð°ÐºÐ¸Ñ… ÐºÐ°Ðº PET, Ð¿Ð¾Ð»Ð¸Ð²Ð¸Ð½Ð¸Ð»Ñ…Ð»Ð¾Ñ€Ð¸Ð´ Ð¸ Ð¼Ð½Ð¾Ð³Ð¸Ðµ Ð´Ñ€ÑƒÐ³Ð¸Ðµ!

ðŸ—‘ï¸ ÐšÐ°Ðº ÑÑ‚Ð¾ Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚?

1. ÐÐ°Ð¶Ð¸Ð¼Ð°Ð¹Ñ‚Ðµ Ð½Ð° ÑÐ¸Ð¼Ð²Ð¾Ð» Ñ€Ð°Ð·Ð´ÐµÐ»ÑŒÐ½Ð¾Ð³Ð¾ ÑÐ±Ð¾Ñ€Ð° â€” ÐºÐ°Ð¶Ð´Ð¾Ðµ Ð½Ð°Ð¶Ð°Ñ‚Ð¸Ðµ Ð¿Ñ€Ð¸Ð½Ð¾ÑÐ¸Ñ‚ Ð²Ð°Ð¼ Ð½Ð¾Ð²Ñ‹Ðµ ÐºÐ¾Ð´Ñ‹ Ð¿ÐµÑ€ÐµÑ€Ð°Ð±Ð¾Ñ‚ÐºÐ¸.
2. Ð˜Ð·ÑƒÑ‡Ð°Ð¹Ñ‚Ðµ ÐºÐ¾Ð´Ñ‹ â€” ÐºÐ°Ð¶Ð´Ð°Ñ Ð¸Ð³Ñ€Ð° Ð¿Ð¾Ð¼Ð¾Ð³Ð°ÐµÑ‚ Ð²Ð°Ð¼ Ð±Ñ‹ÑÑ‚Ñ€ÐµÐµ Ð·Ð°Ð¿Ð¾Ð¼Ð½Ð¸Ñ‚ÑŒ Ð²Ð°Ð¶Ð½ÑƒÑŽ Ð¸Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ð¸ÑŽ Ð¾ Ð¿ÐµÑ€ÐµÑ€Ð°Ð±Ð¾Ñ‚ÐºÐµ Ð¸ Ñ€Ð°Ð·Ð´ÐµÐ»ÑŒÐ½Ð¾Ð¼ ÑÐ±Ð¾Ñ€Ðµ Ð¾Ñ‚Ñ…Ð¾Ð´Ð¾Ð².
3. ÐžÐ±Ð¼ÐµÐ½Ð¸Ð²Ð°Ð¹Ñ‚Ðµ ÐºÐ¾Ð´Ñ‹ Ð½Ð° Ð¶ÐµÑ‚Ð¾Ð½Ñ‹ Ð‘Ð»Ð°Ð³Ð¾ â€” Ð·Ð°Ñ€Ð°Ð±Ð¾Ñ‚Ð°Ð½Ð½Ñ‹Ðµ ÐºÐ¾Ð´Ñ‹ Ð¼Ð¾Ð¶Ð½Ð¾ Ð¾Ð±Ð¼ÐµÐ½ÑÑ‚ÑŒ Ð½Ð° Ð¶ÐµÑ‚Ð¾Ð½Ñ‹, ÐºÐ¾Ñ‚Ð¾Ñ€Ñ‹Ðµ, Ð² ÑÐ²Ð¾ÑŽ Ð¾Ñ‡ÐµÑ€ÐµÐ´ÑŒ, Ð¼Ð¾Ð¶Ð½Ð¾ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÑŒ Ð´Ð»Ñ ÑƒÑ‡Ð°ÑÑ‚Ð¸Ñ Ð² Ñ€Ð°Ð·Ð»Ð¸Ñ‡Ð½Ñ‹Ñ… Ð°ÐºÑ†Ð¸ÑÑ… Ð¸ Ð¼ÐµÑ€Ð¾Ð¿Ñ€Ð¸ÑÑ‚Ð¸ÑÑ… ÑÐ¾Ð¾Ð±Ñ‰ÐµÑÑ‚Ð² Ð”ÐÐž Ð“Ñ€Ð°Ð´Ð¾ÑÑ„ÐµÑ€Ð°, Ð§Ð¸ÑÑ‚Ð°Ñ Ð›Ð¸Ð³Ð°.

ðŸŒ ÐŸÐ¾Ñ‡ÐµÐ¼Ñƒ ÑÑ‚Ð¾ Ð²Ð°Ð¶Ð½Ð¾?
"EcoPlay" Ð½Ðµ Ñ‚Ð¾Ð»ÑŒÐºÐ¾ ÑƒÐ²Ð»ÐµÐºÐ°Ñ‚ÐµÐ»ÐµÐ½, Ð½Ð¾ Ð¸ ÐºÑ€Ð°Ð¹Ð½Ðµ Ð¿Ð¾Ð»ÐµÐ·ÐµÐ½. Ð’Ñ‹ ÑÐ¼Ð¾Ð¶ÐµÑ‚Ðµ Ñ€Ð°Ð·Ð²Ð¸Ñ‚ÑŒ Ð¿Ñ€Ð¸Ð²Ñ‹Ñ‡ÐºÑƒ Ñ€Ð°Ð·Ð´ÐµÐ»ÑŒÐ½Ð¾Ð³Ð¾ ÑÐ±Ð¾Ñ€Ð° Ð¸ Ð¾ÑÐ¾Ð·Ð½Ð°Ð½Ð½Ð¾Ð³Ð¾ Ð¿Ð¾Ñ‚Ñ€ÐµÐ±Ð»ÐµÐ½Ð¸Ñ ÑƒÐ¶Ðµ ÑÐµÐ³Ð¾Ð´Ð½Ñ, Ð° Ñ‚Ð°ÐºÐ¶Ðµ Ð²Ð½ÐµÑÑ‚Ð¸ ÑÐ²Ð¾Ð¹ Ð²ÐºÐ»Ð°Ð´ Ð² Ð·Ð°Ñ‰Ð¸Ñ‚Ñƒ Ð¿Ñ€Ð¸Ñ€Ð¾Ð´Ñ‹!

ÐŸÑ€Ð¸ÑÐ¾ÐµÐ´Ð¸Ð½ÑÐ¹Ñ‚ÐµÑÑŒ Ðº Ð½Ð°Ð¼ Ð² ÑÑ‚Ð¾Ð¼ ÑƒÐ²Ð»ÐµÐºÐ°Ñ‚ÐµÐ»ÑŒÐ½Ð¾Ð¼ Ð¿ÑƒÑ‚ÐµÑˆÐµÑÑ‚Ð²Ð¸Ð¸ Ð¸ ÑÑ‚Ð°Ð½ÑŒÑ‚Ðµ Ñ‡Ð°ÑÑ‚ÑŒÑŽ Ð´Ð²Ð¸Ð¶ÐµÐ½Ð¸Ñ! ÐÐ°Ñ‡Ð½Ð¸Ñ‚Ðµ Ñ€Ð°Ð·Ð´ÐµÐ»ÑŒÐ½Ñ‹Ð¹ ÑÐ±Ð¾Ñ€ Ð¸ ÑƒÑ‡Ð¸Ñ‚ÐµÑÑŒ â€” Ð²Ð¼ÐµÑÑ‚Ðµ Ð¼Ñ‹ Ð¼Ð¾Ð¶ÐµÐ¼ ÑÐ´ÐµÐ»Ð°Ñ‚ÑŒ Ð¼Ð¸Ñ€ Ñ‡Ð¸Ñ‰Ðµ!

/iliga - ÐšÐ°Ñ€Ñ‚Ð° Ð§Ð¸ÑÑ‚Ð°Ñ Ð›Ð¸Ð³Ð°
`;
  const options: SendMessageOptions = {
    parse_mode: "Markdown",
    disable_web_page_preview: true,
    reply_markup: {
      inline_keyboard: [
        [
          {
            text: "â™»ï¸ Ð—Ð°Ð¿ÑƒÑÑ‚Ð¸Ñ‚ÑŒ",
            web_app: { url: "https://ecoplay.mir.one" },
          },
        ],
        [
          {
            text: "â‰ï¸ Ð—Ð°Ð´Ð°Ñ‚ÑŒ Ð²Ð¾Ð¿Ñ€Ð¾Ñ",
            url: "https://t.me/dao_gradosphera_support_bot",
          },
          {
            text: "Ð”Ð¾ÑÑ‚ÑƒÐ¿ Ðº Ð”ÐÐž",
            url: "https://t.me/dao_gradosphera_verify_bot",
          },
        ],
      ],
    },
  };

  bot.sendMessage(chatId, message, options);
});

bot.onText(/\/iliga/, (msg: any) => {
  //todo rm any
  const chatId = msg.chat.id;

  const message = `ÐœÑ‹ â€” ÑÐ¾Ð¾Ð±Ñ‰ÐµÑÑ‚Ð²Ð¾ Â«Ð§Ð¸ÑÑ‚Ð°Ñ Ð›Ð¸Ð³Ð°Â»
ÐÐ°ÑˆÐµ Ð¾Ð±ÑŠÐµÐ´Ð¸Ð½ÐµÐ½Ð¸Ðµ Ð²Ð¾Ð»Ð¾Ð½Ñ‚Ñ‘Ñ€Ð¾Ð² ÑÐ»ÑƒÐ¶Ð¸Ñ‚ Ð±Ð»Ð°Ð³Ð¾ÑƒÑÑ‚Ñ€Ð¾Ð¹ÑÑ‚Ð²Ñƒ Ð³Ð¾Ñ€Ð¾Ð´Ð¾Ð² Ð¸ Ñ€ÐµÑˆÐµÐ½Ð¸ÑŽ Ð¼ÑƒÑÐ¾Ñ€Ð½Ð¾Ð¹ Ð¿Ñ€Ð¾Ð±Ð»ÐµÐ¼Ñ‹. ÐœÑ‹ ÑÐ¾Ð·Ð´Ð°ÐµÐ¼ ÑÐ¸Ð³Ð½Ð°Ð»Ñ‹ Ð¾ Ð¿Ñ€Ð¾Ð±Ð»ÐµÐ¼Ð°Ñ…, ÑÐ¾Ð±Ð¸Ñ€Ð°ÐµÐ¼ Ð²Ð¾Ð»Ð¾Ð½Ñ‚Ñ‘Ñ€Ð¾Ð² Ð¸ Ñ€ÐµÑÑƒÑ€ÑÑ‹ Ð¸ Ð¿Ñ€Ð¾Ð²Ð¾Ð´Ð¸Ð¼ Ð¾Ð±Ñ‰Ð¸Ðµ Ð¼ÐµÑ€Ð¾Ð¿Ñ€Ð¸ÑÑ‚Ð¸Ñ Ð¿Ð¾ Ð¸Ñ… Ñ€ÐµÑˆÐµÐ½Ð¸ÑŽ.

**ÐšÐ°Ðº ÑÑ‚Ð¾ Ñ€Ð°Ð±Ð¾Ð¾Ñ‚Ð°ÐµÑ‚?**
Ð”Ð»Ñ Ñ€ÐµÑˆÐµÐ½Ð¸Ñ Ð¼ÑƒÑÐ¾Ñ€Ð½Ð¾Ð¹ Ð¿Ñ€Ð¾Ð±Ð»ÐµÐ¼Ñ‹ Ð¼Ñ‹ ÑÐ¾Ð·Ð´Ð°ÐµÐ¼ Ð¾ Ð½ÐµÐ¹ ÑÐ¸Ð³Ð½Ð°Ð»Ñ‹, Ð¿Ð»Ð°Ð½Ð¸Ñ€ÑƒÐµÐ¼ Ð¼ÐµÑ€Ð¾Ð¿Ñ€Ð¸ÑÑ‚Ð¸Ðµ Ð¿Ð¾ ÑƒÐ±Ð¾Ñ€ÐºÐµ Ð¼ÑƒÑÐ¾Ñ€Ð° Ð¸, Ð½Ð°ÐºÐ¾Ð½ÐµÑ†, Ð¿Ñ€Ð¾Ð²Ð¾Ð´Ð¸Ð¼ ÑƒÐ±Ð¾Ñ€ÐºÑƒ.

ðŸ†˜ ÐŸÑ€Ð¾Ð±Ð»ÐµÐ¼Ð°
ÐœÑƒÑÐ¾Ñ€ Ð½Ð° ÑƒÐ»Ð¸Ñ†Ðµ. Ð Ð°Ð·Ñ€ÑƒÑˆÐµÐ½Ð½Ð¾Ðµ Ð±Ð»Ð°Ð³Ð¾ÑƒÑÑ‚Ñ€Ð¾Ð¹ÑÑ‚Ð²Ð¾.

ðŸ“· ÐžÐ¿Ð¸ÑˆÐ¸Ñ‚Ðµ Ð¿Ñ€Ð¾Ð±Ð»ÐµÐ¼Ñƒ
ÐžÑ‚Ð¼ÐµÑ‚ÑŒÑ‚Ðµ Ñ‚Ð¾Ñ‡ÐºÑƒ Ð½Ð° ÐºÐ°Ñ€Ñ‚Ðµ. ÐžÐ¿Ð¸ÑˆÐ¸Ñ‚Ðµ Ð¿Ñ€Ð¾Ð±Ð»ÐµÐ¼Ñƒ Ð¸Ð»Ð¸ Ð¸Ð´ÐµÑŽ. ÐŸÑ€Ð¸ÐºÑ€ÐµÐ¿Ð¸Ñ‚Ðµ Ñ„Ð¾Ñ‚Ð¾.

ðŸ”ƒ ÐžÐ±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ° ÑÐ¸Ð³Ð½Ð°Ð»Ð°
ÐŸÐ¾ÑÐ»Ðµ Ð¼Ð¾Ð´ÐµÑ€Ð°Ñ†Ð¸Ð¸ ÑÐ¸Ð³Ð½Ð°Ð» Ð¿Ð¾Ð¿Ð°Ð´Ð°ÐµÑ‚ Ð½Ð° ÐºÐ°Ñ€Ñ‚Ñƒ Ð¸ Ð² ÑÐ¿Ð¸ÑÐ¾Ðº. ÐŸÐ¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ð¸ Ð³Ð¾Ð»Ð¾ÑÑƒÑŽÑ‚ Ð·Ð° ÑÐ¸Ð³Ð½Ð°Ð»Ñ‹.

ðŸ“¢ Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ ÑÐ¾Ð±Ñ‹Ñ‚Ð¸Ñ
Ð›ÑŽÐ±Ð¾Ð¹ Ð²Ð¾Ð»Ð¾Ð½Ñ‚Ñ‘Ñ€ Ð¼Ð¾Ð¶ÐµÑ‚ Ð²Ð·ÑÑ‚ÑŒ Ð½Ð° ÑÐµÐ±Ñ Ñ€Ð°Ð±Ð¾Ñ‚Ñƒ Ñ ÑÐ¸Ð³Ð½Ð°Ð»Ð¾Ð¼ Ð¸ Ð½Ð°Ð·Ð½Ð°Ñ‡Ð¸Ñ‚ÑŒ ÑÐ¾Ð±Ñ‹Ñ‚Ð¸Ðµ Ð´Ð»Ñ ÐµÐ³Ð¾ Ñ€ÐµÑˆÐµÐ½Ð¸Ñ. ÐžÐ½ ÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ñ‚ÑÑ Ñ…Ð¾Ð·ÑÐ¸Ð½Ð¾Ð¼ ÑÐ¾Ð±Ñ‹Ñ‚Ð¸Ñ. Ð•Ð¼Ñƒ Ð½ÑƒÐ¶Ð½Ð¾ Ð¾Ð¿Ñ€ÐµÐ´ÐµÐ»Ð¸Ñ‚ÑŒ Ð´Ð°Ñ‚Ñƒ Ð¸ Ð²Ñ€ÐµÐ¼Ñ ÑÐ¾Ð±Ñ‹Ñ‚Ð¸Ñ, Ð²Ð·ÑÑ‚ÑŒ Ð¿ÐµÑ€Ñ‡Ð°Ñ‚ÐºÐ¸, Ð¶Ð¸Ð»ÐµÑ‚Ñ‹ Ð¸ Ð¿Ñ€Ð¾Ñ‡Ð¸Ð¹ Ð¸Ð½Ð²ÐµÐ½Ñ‚Ð°Ñ€ÑŒ Ð² Ð¿ÑƒÐ½ÐºÑ‚Ð°Ñ… Ð½Ð°ÑˆÐ¸Ñ… [ÐŸÐ°Ñ€Ñ‚Ð½Ñ‘Ñ€Ð¾Ð²](https://info.iliga.ru/#!).

ðŸ§¹ Ð¡Ð±Ð¾Ñ€ ÑƒÑ‡Ð°ÑÑ‚Ð½Ð¸ÐºÐ¾Ð² Ð½Ð° ÑÐ¾Ð±Ñ‹Ñ‚Ð¸Ðµ ÑÑ€ÐµÐ´Ð¸ Ð²Ð¾Ð»Ð¾Ð½Ñ‚Ñ‘Ñ€Ð¾Ð².
Ð›ÑŽÐ±Ð¾Ð¹ Ð²Ð¾Ð»Ð¾Ð½Ñ‚Ñ‘Ñ€ Ð¼Ð¾Ð¶ÐµÑ‚ Ð¿Ñ€Ð¸ÑÐ¾ÐµÐ´Ð¸Ð½Ð¸Ñ‚ÑÑ Ðº ÑÐ¾Ð·Ð´Ð°Ð½Ð½Ð¾Ð¼Ñƒ ÑÐ¾Ð±Ñ‹Ñ‚Ð¸ÑŽ!

/start -5 EcoPlay
`;
  const options: SendMessageOptions = {
    parse_mode: "Markdown",
    disable_web_page_preview: true,
    reply_markup: {
      inline_keyboard: [
        [
          {
            text: "ðŸ—º ÐžÑ‚ÐºÑ€Ñ‹Ñ‚ÑŒ ÐºÐ°Ñ€Ñ‚Ñƒ",
            url: "https://t.me/iligarubot/app",
          },
        ],
        [
          {
            text: "Ð¡ÐœÐ˜",
            url: "https://t.me/iLigaKMS",
          },
          {
            text: "Ðž Ð½Ð°Ñ",
            url: "https://info.iliga.ru/About",
          },
        ],
      ],
    },
  };

  bot.sendMessage(chatId, message, options);
});

bot.on("polling_error", console.log);


const app = express();
app.use(express.json());
app.use(express.urlencoded({ extended: false }));
// app.use(express.static(join(path.resolve(''), 'public')));

app.set('port', SERVER_PORT);

const server = http.createServer(app);
server.listen(SERVER_PORT);

server.on('listening', () => {
    console.info(`Listening on ${SERVER_PORT}`);
});
